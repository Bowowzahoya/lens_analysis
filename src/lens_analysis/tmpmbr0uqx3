# -*- coding: utf-8 -*-
"""
Created on Tue Jul 27 11:25:32 2021

@author: David
"""
import pandas as pd

from .constants import *

def guess_aliases(app_df, apps, known_abbrevs={}):
    AL_NAME = "Alias"
    NM_NAME = "Name"
    alias_sr = pd.Series(name=AL_NAME)
    alias_sr.index.name = NM_NAME
    for app in apps:
        joint_apps = app_df.loc[app, JPW_COL]
        joint_apps = joint_apps.split(SEP)

        # occurs anywhere inside?
        more_apps = find_extended_form_of_app(app, app_df.index)
        joint_apps.append(more_apps)
        
        # any known abbreviations?
        if app in known_abbrevs.keys():
            more_apps = find_extended_form_of_app(known_abbrevs[app], app_df.index)
            joint_apps.append(more_apps)

        joint_apps = sorted(joint_apps)
        new_aliases = pd.Series(index=joint_apps, data=normal_case(app),
                                name=AL_NAME)
        new_aliases.index.name = NM_NAME
        alias_sr = alias_sr.append(new_aliases)
    return alias_sr
        
        
def normal_case(s):
    words = s.split(" ")
    for ix, word in enumerate(words):
        if len(word) > 1:
            words[ix] = word[0].upper()+word[1:].lower()
        
    return " ".join(words)

def find_extended_form_of_app(app_to_find, apps):
    return [app for app in apps if app_to_find in app]

def remove_common_terms(app):
    COMMON_TERMS = ["CO", "LTD", "INC", "CORP", "LLC", "BV"]
    
        
        